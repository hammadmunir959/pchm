{% extends "admin/base_site.html" %}
{% load static %}

{% block title %}Theme Selector | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    &rsaquo; <a href="{% url 'admin:theming_event_changelist' %}">Theming</a>
    &rsaquo; Theme Selector
</div>
{% endblock %}

{% block content %}
<h1>Theme Selector & Preview</h1>

<div style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-left: 4px solid #007cba; border-radius: 4px;">
    <h2 style="margin-top: 0;">Current Status</h2>
    <p><strong>Active Theme:</strong> <span style="color: #007cba; font-weight: bold;">{{ current_theme.theme.name }}</span> ({{ current_theme.theme_key }})</p>
    {% if preview_theme %}
        <p style="color: #d63638;"><strong>Preview Mode Active:</strong> {{ preview_theme|title }} theme is being previewed</p>
        <p style="font-size: 0.9em; color: #666;">Visit the frontend to see the preview. Other users will see the active theme based on events.</p>
    {% else %}
        <p style="color: #00a32a;">No preview mode active. The active theme is determined by events.</p>
    {% endif %}
</div>

<div style="margin-bottom: 30px;">
    <h2>Available Themes</h2>
    <p>Select a theme to preview it on the frontend. Preview mode only affects your session.</p>
    
    <form method="post" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">
        {% csrf_token %}
        {% for theme_key, theme_data in themes.items %}
        <div style="border: 2px solid {% if preview_theme == theme_key %}#007cba{% elif current_theme.theme_key == theme_key %}#00a32a{% else %}#ddd{% endif %}; 
                    border-radius: 8px; 
                    padding: 20px; 
                    background: white;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    transition: transform 0.2s, box-shadow 0.2s;"
             onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 8px rgba(0,0,0,0.15)';"
             onmouseout="this.style.transform=''; this.style.boxShadow='0 2px 4px rgba(0,0,0,0.1)';">
            
            <div style="display: flex; align-items: center; margin-bottom: 15px;">
                <div style="width: 50px; height: 50px; border-radius: 8px; background: {{ theme_data.primary_color }}; 
                            margin-right: 15px; border: 2px solid {{ theme_data.secondary_color }}; 
                            box-shadow: 0 2px 4px rgba(0,0,0,0.2);"></div>
                <div>
                    <h3 style="margin: 0; font-size: 1.2em;">{{ theme_data.name }}</h3>
                    <p style="margin: 5px 0 0 0; color: #666; font-size: 0.9em;">{{ theme_key }}</p>
                </div>
            </div>
            
            <div style="margin-bottom: 15px;">
                <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                    <div style="flex: 1;">
                        <div style="font-size: 0.85em; color: #666; margin-bottom: 3px;">Primary</div>
                        <div style="width: 100%; height: 30px; background: {{ theme_data.primary_color }}; 
                                    border-radius: 4px; border: 1px solid #ddd;"></div>
                        <div style="font-size: 0.8em; color: #999; margin-top: 3px;">{{ theme_data.primary_color }}</div>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-size: 0.85em; color: #666; margin-bottom: 3px;">Secondary</div>
                        <div style="width: 100%; height: 30px; background: {{ theme_data.secondary_color }}; 
                                    border-radius: 4px; border: 1px solid #ddd;"></div>
                        <div style="font-size: 0.8em; color: #999; margin-top: 3px;">{{ theme_data.secondary_color }}</div>
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 15px; font-size: 0.9em;">
                <div style="margin-bottom: 5px;"><strong>Animations:</strong> 
                    {% if theme_data.animations %}
                        {{ theme_data.animations|join:", " }}
                    {% else %}
                        None
                    {% endif %}
                </div>
                {% if theme_data.popup %}
                <div><strong>Popup:</strong> {{ theme_data.popup.title }}</div>
                {% endif %}
            </div>
            
            <div style="display: flex; gap: 10px;">
                {% if preview_theme == theme_key %}
                    <button type="submit" name="action" value="clear_preview" 
                            style="flex: 1; padding: 10px; background: #d63638; color: white; 
                                   border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
                        Clear Preview
                    </button>
                {% else %}
                    <button type="submit" name="action" value="set_preview" 
                            style="flex: 1; padding: 10px; background: #007cba; color: white; 
                                   border: none; border-radius: 4px; cursor: pointer; font-weight: bold;"
                            onclick="this.form.querySelector('input[name=theme_key]').value='{{ theme_key }}';">
                        Preview Theme
                    </button>
                {% endif %}
                
                {% if current_theme.theme_key == theme_key %}
                    <span style="flex: 1; padding: 10px; background: #00a32a; color: white; 
                                 border-radius: 4px; text-align: center; font-weight: bold;">
                        Active
                    </span>
                {% endif %}
            </div>
            
            <input type="hidden" name="theme_key" value="{{ theme_key }}">
        </div>
        {% endfor %}
    </form>
</div>

<div style="margin-top: 30px; padding: 15px; background-color: #fff3cd; border-left: 4px solid #ffc107; border-radius: 4px;">
    <h3 style="margin-top: 0;">How to Use</h3>
    <ol style="margin-bottom: 0;">
        <li><strong>Preview a Theme:</strong> Click "Preview Theme" on any theme card. This will set preview mode for your session.</li>
        <li><strong>View Preview:</strong> Open the frontend website in a new tab to see the preview theme applied.</li>
        <li><strong>Clear Preview:</strong> Click "Clear Preview" to disable preview mode and return to the active theme based on events.</li>
        <li><strong>Set Active Theme:</strong> To make a theme active, create or edit an Event with that theme and ensure it's active and covers today's date.</li>
    </ol>
</div>

<div style="margin-top: 20px;">
    <a href="{% url 'admin:theming_event_changelist' %}" style="display: inline-block; padding: 10px 20px; 
                                                                    background: #007cba; color: white; 
                                                                    text-decoration: none; border-radius: 4px;">
        Manage Events
    </a>
    <a href="{% url 'admin:index' %}" style="display: inline-block; padding: 10px 20px; margin-left: 10px;
                                            background: #666; color: white; 
                                            text-decoration: none; border-radius: 4px;">
        Back to Admin Home
    </a>
</div>

<style>
    @media (max-width: 768px) {
        form[style*="grid"] {
            grid-template-columns: 1fr !important;
        }
    }
</style>
{% endblock %}

